
# როგორ დავაპროგრამოთ Pagekit-ის გაფართოება


<p class="uk-article-lead">ამ სახელმძღვანელოში აღწერილია ყველა ნაბიჯი, რომელიც საჭიროა სრულყოფიფი ToDo გაფართოების შესამუშავებლად და მოსაწყობად Pagekit-ის ადმინ განყოფილებაში. მოცემულია ძირითადი ცნებები გაფართოების, კონტროლერების, მარშუტიზაციის, წარმოდგენების რენდერინგის და Вы узнаете об основных понятиях расширений, контроллерах, маршрутизации, рендеринге представлений и инфраструктуре Vue.js სამუშაო გარემოსი.</p>

## შინაარსი

<ol>
<li><a href="#step-1-extending-pagekit-using-modules">Pagekit-ის გაფართოება მოდულების საშუალებით</a></li>
<li><a href="#step-2-routing-and-controller">მარშუტიზაცია და კონტროლერები</a></li>
<li><a href="#step-3-view-rendering-and-module-config">წარმოდგენების რენტერინგიდა მოდულის კონფიგურაცია</a></li>
<li><a href="#step-4-using-vue-js-in-a-pagekit-extension"> Vue.js-ს გამოყენება Pagekit-ის გაფართოებაში</a></li>
<li><a href="#the-completed-example">დასრულებული მაგალითი</a></li>
</ol>

[ნაბიჯი 2: მარშუტიზაცია და კონტროლერი](ნაბიჯი-2-მარშუტიზაცია-და-კონტროლერი)

ინგლისურ ენაზე ხელმისაწვდომია აგრეთვე ვიეოების სერია [Youtube playlist with all screencasts](https://www.youtube.com/playlist?list=PL2rU5GxE-MQ7aYIcxTmDh4-BTHRM-9lto).

**შენიშვნა** Github-ზე არის [დასრულებული მაგალითი](https://github.com/pagekit/example-todo).

## ნაბიჯი 1: Pagekit-ის გაფართოება მოლულების გამოყნენებით


<p class="uk-article-lead">როგორც პროგრამისტმა, ადვილად შეიძლება იმ შესაძლებლობების გაფართოება, რასაც  Pagekit გვთავაზობს დასაწყისში. იმისდამიუხედავად, რა გვინდა, შევქმნათ საკუთარი თემა ან დამატებითი ფუნქციონალობის გაფართოება, ორივე აგებული იქნება ერთი და იგივე მიდგომით. ამ პირველ ეტაპზე წარმოვიდგენთ რა არის *პაკეტი(package)* და რა არის *მოდული(Module)* - ორივე დაფუძნებულია Pagekit-ის კონცეფციაზე.</p>

<a href="https://www.youtube.com/watch?v=m6ntYDOCG4s&index=1&list=PL2rU5GxE-MQ7aYIcxTmDh4-BTHRM-9lto" class="uk-button">იხ( ამ ნაბიჯის ვიდეო</a>

### ტერმინოლოგია: პაკეტი და მოდული
თემა და გაფართოება გარეგნულად შესაძლოა მოგვეჩვენოს განსხვავებულად, მაგრამ ორივეს ჩვენ ვუწოდებთ *პაკეტს*. პაკეტი - ეს არის პაპკა, რომელშიც გაერთიანებულია რამდენიმე ფაილი და შეიცავს მეტა-მონაცემებს ფაილში სახელით `composer.json`.

იმისათვის, რომ რამე დავარეგისტრიროთ Pagekit-ის სისტემაში, აგრეთვე საჭიროა ჩავრთოთ ფაილი სახელით - `index.php`. ის შეიცავს იმის განსაზღვრებას, რასაც ჩვენ ვუწოდებთ *მოდულს*. მოდული წარმოადგენს ყველაზე უფრო მნიშვნელოვან სტრუქტურას Pagekit-ის კოდში. მოდულები თავის მხრივ წარმოადგენენ ავტონომიურ მოდულებს, რომელებიც აერთიანებენ ფუნქციონალურ შესაძლებლობებს და ერთიანდებიან ერთიან სისტემაში. მოდულები გამოიყენება, როგორც Pagekit-ის ბირთვში, ასევე მესამე მხარის მიერ შემუშავებულ გაფართოებაში.

### სად უნდა განვათავსოთ ჩვენი საკუთარი პაკეტის ფაილები

ყოველი პაკეტი ეკუთვნის ავტორის მიერ განსაზღვრულ სახელს, რაც უფრო გასაგები გახდება, თუ შევხედავთ ახლად დაყენებული Pagekit-ის ფაილების წყობას.

საბაზო პაკეტები არიან Базовые пакеты являются частью пространства имен `pagekit` სახელების სივრცის ნაწილი და განთავსებული არიან კვეკატალოგში სახელად ` / packages`. ყველა მხარის პაკეტები (ჩვენი) ფლობენ საკუთარ სახელთა სივრცეს და შესაბამისად განთავსებული არიან ცალკე ქვეკადალოგში.

```
/packages
    /pagekit
        /blog
        /theme-one
    /your-vendor
        /your-theme
        /your-extension
```

ნებისმიერ პაკეტში არის მინიმუმ 2 ფაილი : `composer.json` და `index.php`.

### 1. composer.json: პაკეტის მეტა-მონაცემები

`composer.json` ფაილი შეიცავს პაკეტის მეტა-მონაცემებს. ეს მონაცემები აისახება Pagekit-ის ბექენდში და გამოიყენება Pagekit marketplace-ში, თუ ეს პაკეტი აიტვირთება იქ.

`packages/pagekit/todo/composer.json`

```
{
    "name": "pagekit/todo",
    "version": "0.1",
    "type": "pagekit-extension",
    "title": "ToDo management"
}
```

### 2. index.php: მოდულის განსაზღვრა

მოდულები კრავენ ფუნქციონალს Pagekit-ის შიგნით და საშუალებას გვაძლევენ ჩავერთოთ Pagekit სისტემაში. კოდის თვალსაზრისით, მოდულის განსაღვრება - ეს არის PHP მასივი, რომლისათვის იწერება განსაზღვრული თვისებებიдля. `Index.php`-მ ყოველთვის უნდა `დააბრუნოს` ნამდვილი მასივი.

```
<?php

use Pagekit\Application;

// packages/pagekit/todo/index.php

return [

    'name' => 'todo',

    'type' => 'extension',

	// გამოიძახება როცა Pagekit გააკეთებს მოდულის ინიციალიზაციას
    'main' => function (Application $app) {
        echo "ის ცოცხალია";
    }
];

?>
```

რომ შევამოწმოთ, როგორ მუშაობს, გაფართოება ჩართული უნდა იყოს ბექენდში. როცა ის აქტიურია (მწვანე ), წარწერა (It's alive) დაიბეჭდება ეკრანის მაღლითა ნაწილში.

ეს მინიმალური მაგალითი გვიჩვენებს, თუ როგორი პატარა შეიძლება იყოს მთლიანად ფუნქციონირებადი მოდული. მას აქვს დაშვება `Application` ეგზაპლიართან. ამ ობიექტის დახმარებით შესაძლებელია მივიღოთ დაშვებანებისმიერ სერვისთან, გამოვიძახოთ მოვლენა ან მოვუსმინოთ სხვა მოდულების მიერ გამოძახებულ მოლენას.

## ნაბიჯი 2: მარშუტიზაცია და კონტროლერი

<p class="uk-article-lead">მას მერე, რაც გაფართოების საბაზო სტრუქტურა დაწყობილია, ჩვეულებრივი ამოცანა ხდება ჩვენი საკუთარი კონტროლერების რეგისტრაცია და ადმინ პანელში მენიუს პუნქტების დამატება, ამისათვის განვიხილავთ რამდენიმე დამატებით თვისებას, რომელიც შესაძლებელია დაემატოს მოდულის განსაზღვრებას  `index.php` ფაილში.</p>

<a href="https://www.youtube.com/watch?v=Hi7WGVSI3aw&index=2&list=PL2rU5GxE-MQ7aYIcxTmDh4-BTHRM-9lto" class="uk-button">ნახეთ ამ ნაბიჯის ვიდეო</a>

### კონტროლერის დამატება

Pagekit-ის კონტროლერი - ეს არის PHP-ის მარტივი კლასი. ნებისმიერი, სწორ სახელიანი ( ასეთი სახის `რამეAction ()`), მონტირდება Pagekit-ის მარშუტიზაციით (ანუ `/ todo / რამე`)

სწორი სახელისთვი, რა თქმა უნდა ვიყენებთ ლათინურ ასოებს (ა. ფ.)

შევქმნათ ფაილი `packages / pagekit / todo / src / Controller / TodoController.php` შემდეგი კოდით შიგ.
```
<?php

namespace Pagekit\Todo\Controller;

/**
 * @Access(admin=true)
 */
class TodoController
{

    public function indexAction()
    {
       return "ჰეი.";
    }

}
```

იმისათვის, რომ დავუშვათ მხოლოდ ადმინისტრატორის წვდომა და მივუერთოთ  ეს კონტროლერი ადინისტრატორის URL-მისამართს უნდა გამოვიყენოთ ანოტაცია `@Access (admin = true)`. ანოტაციები - ეს არის გასაღები ტერმინები, რომელებიც თავსდებიან კლასის ან მეთოდის დასაწყისში მოყვანილ გომენტარის ბლოკში. მეტი [ანოტაციების შესახებ] (http://pagekit.com/docs/developer/routing#annotations) წაიკითხეთ ამ ბმულზე.

იმისათვის, რომ შევძლოთ ამ კონტროლერის გამოყენება, საჭიროა ავტომატურად ჩავტვირთოთ ჩვენი სახელების სივრცე და მივუერთოთ კონტროლერი მარშუტს. დავამატოთ შემდეგი თვისება index.php ფაილის კონფიგურაციის მასივში.


```
	// ...

	// სახელობითი სივრცეთა მასივი რომელიც ავტომატურად იტვირთება მოცემული პაპკიდან
	'autoload' => [
        'Pagekit\\Example\\' => 'src'
    ],


	// array of routes
    'routes' => [

    	// მარშუტის ბმულის იდენტიფიკატორი ამ კოდში
        '@todo' => [

            // რომელ გზაზე უდა დადგეს ეს კონკრეტული გაფართოება
            'path' => '/todo',

            // რომელი კონტროლერი უნდა მოებას
            'controller' => 'Pagekit\\Todo\\Controller\\TodoController'
        ]
    ],

    // ...
```

ამის მერე იხსნება წვდომა ახალ კონტროლერზე, რომელიც არის შემდეგ მისამართზე `<pagekit_გზა>/admin/todo`.

შენიშვნა: როგორ იქმნება ეს მისამართი ოთხი ნაწილისაგან:

1. `<pagekit_path>` ყველა URL-ი იწყება საიტის ძირითადი url-დან
2. `@Access(admin=true)` უერთებს ადმინისტრატორის url-ს `/admin`
3. კონტროლერი ებმება როგორც  `/todo`
4. `indexAction` არის ავტომატური მარშუტი ამ  url-თვის.

თუ შეფერხდა მარშუტთან წვდომა, უნდა [გავასუფთაოთ კეში](http://pagekit.com/docs/user-interface/system#cache). უკეთესი წარმადობისათვის Pagekit-ი ახდენს მარუტების კეშირებას.

### Debug ინსტრუმენტების პანელი

იმისათვის, რომ ვნახოთ ყველა მარშუტი პროგრამირების პროცესში, უნდა ჩაირთოს *Debug ინსტრუმენტების პანელი* Pagekit-ის სისტემური პარამეტრებიდან. ინტრუმენტების პანელი იკავებს ეკრანის ქვედა ზოლს და მაში აისეხება ყველა რეგირტრირებული მარშუტი და რიგი სხვა სასარგებლო ინფორმაცია.

არ აგამოგრჩეთ ამ ინსტრუმენტის გამორთვა ცოცხალი ვებსაიტისათვის.

### მენიუს პუნქტის დამატება

მენიუს პუნქტის დასამატებლად მოდულის აღწერაში უნდა გამოიყენოთ თვისება `menu`. დავამატოთ შემდეგი `index.php` ფაილში.

```
// ...

'menu' => [
    'example' => [
        'label'  => 'ToDo',
        'icon'   => 'app/system/assets/images/placeholder-icon.svg',
        'url'    => '@todo',
    ]
],
// ...
```

გავაახლოთ (დავარეფრეშოთ)  Pagekit-ის ბექენდი და დავინახავთ ახალ მეინუს ბმულს `@todo`.

## ნაბიჯი 3: ხედის (წარმოდგენის view) რენდერინგი და მოდულის კონფიგურაცია

<p class="uk-article-lead">წინა ნაბიჯებით გავიარეთ მოდულების და მარშუტიზაციის საფუძვლები. ამის მიუხედავათ, ჩვენი პირველი კონტროლერმა დაგვიწერა მხოლოდ ერთი მარტივი სტრიქონი. შემდეგ ეტაპზე განვიხილოთ ხედის ფაქტიური რენდერინგი.</p>

<a href="https://www.youtube.com/watch?v=EwCAtxcsz18&index=3&list=PL2rU5GxE-MQ7aYIcxTmDh4-BTHRM-9lto" class="uk-button">ვნახოთ ნაბიჯის ვიდეო</a>

### ხედის რენდერი კონტროლერის მოქმედებით

იმისათვის,რომ წარმოდგენას (ხედს - View) გადაეცეს პარამეტრები, კონტროლერის ექშენ-მეთოდი აბრუნებს PHP მასივს. რეზერვირებული გასაღები  `$view` შეიცავს პარამეტრებს ვიზუალური წარმოდგენის საშუალებისათვის, ანუ გამოსახვის ფაილის `სახელს`.

```
public function indexAction()
{
    return [
    	'$view' => [
            'title' => 'TODO management',
            'name' => 'todo:views/admin/index.php'
        ],
        'message' => 'Hello how\'s it going?'
    ];
}
```

წარმოდგენის რენდერ ფაილი არის მარტივი PHP შაბლონი. მარტივი პარამეტრები (ისეთი, როგორც `message`) ხელმისაწდომია PHP ცვლადების სახით (იგივე `$message`).

`packages/pagekit/todo/views/admin/index.php`:

```
<h1><?php echo $message; ?></h1>
```


### რესურსების შემოკლება

იმის მაგივრად, რომ ვწეროთო ფაილის მთლიანი გზა, შეგვიძლია ვისარგებლოთ შემოკლებული სინტაქსით. `packages/pagekit/todo/views/admin/index.php` გამიოისახება ` todo:views/admin/index.php`. ეს უკეთ იბეჭდება და იკითხება.

შემოკლების რეგისტრაცია მიზნობრივი მისამართით ხდება ფაილში  index.php. ამ მაგალითში `todo:`-თი მივუთითებთ `index.php`-ს მიმდინარე მისამართზე.

```
'resources' => [
    'todo:' => ''
],
```

### მოდულის კონფიგურირება

მოდული შესაძლებელია მოიცეს ნებიმიერი პარამეტრების შესანახ კონფიგურაციის მასივის სახით. ჩვენს შემთხვევაში შეგვიძლია გამოვიყენოთ, როგორც მარტივი საყობი ჩვენი TODO ელემენტებისათვის.

```
'config' => [
    'entries' => [
        ['message' => 'Buy milk.', 'done' => false], // ...
    ]
],
```




კონტროლერიდან ამ კონფიგურაციას შესაძლებელია მივწვდეთ როგორც მოდულის ეგზეპლიარის პარამეტრებს.

`src/Controller/TodoController.php`:

```
use Pagekit\Application as App;

// ...

	$module = App::module('todo');
	$config = $module->config;

// ...
```

ჩვენ შეგვიძლია შევინახოთ მონაცემთა ბაზაში მოდულის კონფიგურაციაში შეტანილი ცვლილებები. მოდულის კონფიგურაციის ცვლილებები ერთიანდება შენახულ ცვლილებებთან, ამიტომ კონტროლერში ყოველთვის იქნება ნამდვილი კონფიგურაცია.

```
// მოდულის კონფიგურაციის ცვლილება
App::config('todo')->set('entries', $entries);
```

## ნაბიჯი 4: Using Vue.js-ის გამოყენება Pagekit-ის გაფართოებაში

<p class="uk-article-lead">ადმინ პანელისათმვის საკუთარი სკრინების შესაქმნელად შესაძლებელია ნებისმიერი ბიბლიოთეკის გამოყენება შესაძლებელია, თუმცა იმის გამო რომ Pagekit-ი მოგვეწოდება უკვე ჩაშენებული Vue.js ტექნოლოგიით, სასურველი და სასარგებლო იქნება მისი შესწავლა და გამოყენება. ამ განყოფილებაში შესაძლებელია Vue.js-ის პრინციპებთან და საფუძვლებთან გაცნობა inside Pagekit-ის შიგნით.</p>

<a href="https://www.youtube.com/watch?v=3gPGyhTroSA&list=PL2rU5GxE-MQ7aYIcxTmDh4-BTHRM-9lto&index=4" class="uk-button">ამ ნაბიჯის ნახვა ვიდეოში</a>

### 1. JavaScript-ში მონაცემთა გადაცემა

სხვა სტატიებში ჩვენ ვნახეთ, თუ როგორ უნდა მივწვდეთ მონაცემებს  PHP კონტროლერებში. ამ მონაცემების JavaScript-ში გადასაცემად დამოიღენება კოდური ტერმინი `$data` PHP მასივის გადასაცემად ვიზუალური წარმოდგენის გარემოში. Pagekit-ი ამ წარმოდგენას ავტომატურად გადააკეთებს JSON წარმოდგენაში და გამოსახავს მას დაგენერირებული HTML-ის სათაურის განყოფილებაში.


```
// packages/pagekit/todo/src/Controller/TodoController.php

// ...

public function indexAction()
{
    $module = App::module('todo');

    return [
        '$view' => [
            'name' => 'todo:views/admin/index.php'
        ],
        '$data' => $module->config
    ];
}
```

ეს შემდეგნაირად გამოისახება ჩვენი გვერდის  `<head>` სექციაში.

```
<script>var $data = {"entries": [{"message":"Buy milk","done":false},{"message":"Drink coffee","done":true}] };</script>
```


### 2. გამოსახვის და მოდელის კომბინირება

ViewModel - ეს არის  `Vue`-ს ეგზეპლიარი, რომელიც უზრუნველყოფს მონაცემების სინხრონიზაციას ჩვენი მოდელიდან გამოსახვის ინტერფეისში. ამას ჰქვია *რეაქტიულობა* და წარმოადგენს Vue-ს ერთერთ ძირეულ განსაკუთრებულობას. სწორი გამოყენების შემთხვევაში ის გვეხმარება, რომ  ჩვენი JavaScript კომპონენტები იყოს პატარა და მოხერხებულად წასაკითხი.

ჩვენ შეგვიძლია დავუერთოთ `Vue`-ს ეგზემპლიარი DOM (` el: '# todo'`) ელემენტს. მოდელი იქნვება ის, რასაც გადავცემთ  `data` პარამეტრს. Чтобы использовать данные из Pagekit-დან მონაცემების გამოყენებისათვის, უნდა ავიღოთ возьмите глобальный объект `window.$Data` გლობალური ელემენტი, რომელიც გამოიტანს ჩვენს გამოსახვას.

ნებისმიერი ჩვენს მიერ შექმნილი `methods`, შესაძლებელია გამოძახებული იქნას ჩვენი შაბლონიდან. შაბლონის დაკაბადონებას გავაკეთებთ შემდეგ ნაბიჯზე.


```

// packages/pagekit/todo/js/todo.js

$(function(){

    var vm = new Vue({

        el: '#todo',

        data: {
            entries: window.$data.entries,
        },

        methods: {

            add: function(e) {
                // ...
            },

            toggle: function(entry) {
                entry.done = !entry.done;
            },

            remove: function(entry) {
                this.entries.$remove(entry);
            },

            save: function() {
                // ...
            }

        }

    });

});
```

### 2. Vue-ს დაკაბადონება


PHP-დან გამოსახვის  `views/admin/index.php` ფაილს ვარენდეებთ ჩვეულებრივისამებრ. აქ ვუერთებთ აუცილებელ JavaScript ფაილს. სკრიპტში Vue-ს ხელმისაწვდომობისათვის მესამე პარამეტრად ვუმატებთ დამოკიდებულებას `vue`.

```
<?php $view->script('todo', 'todo:js/todo.js', 'vue') ?>
```

В ваш HTML-ში ვრთავთ  включите элемент DOM ელემენტს, რომელსაც მოძებნის Vue ეგზეპლიარი (`<div id =" todo "> </ div>`). ამ ელემენტის შიგნით შესაძლებელია Vue დირექტივების გამოყენება. დირექტივა - ეს არის განსაზღვრული სიტყვა გასაღები, რომელიც აგებინებს Vue-ს, რა გაუკეთოს ელემენტს.

```
<p v-if="entry.done">ეს გამოიყახება მაშინ, როდესაც ელემენტი იქნება დასრულებული.</p>
```

`@click`-ით შეგვიძლია მივებათ click მოვლენას და გამოვიძახოთ მეთოდები წარმოსახვის მოდელიდან.

მოდელიდან მნიშვნელობების გამოსატანად უნდა ვისარგებლოთ ფიგურული ფრჩხილებით (`{{entry.message}}`). Pagekit წარმოგვიდგენს  `trans` ფილტრს, რომელიც წარმოსახვის სტრიქონს შეცვლის ალტერნატიულით, თუ ამორჩეული ლოკალისათვის ძირეულ კატალოგში არსებობს თარგმანი.

```
{{ 'Save' | trans }}
```

აი ასე შეიძლება, რომ გამოიყურებოდეს უმარტივესი წარმოსახვა (view).

```
<!-- packages/pagekit/todo/views/admin/index.php -->

<?php $view->script('todo', 'todo:js/todo.js', 'vue') ?>

<div id="todo">

    <button @click="save()">{{ 'Save' | trans }}</button>

    <ul>
        <li v-for="entry in entries">
            {{ entry.message }}

            <button @click="toggle(entry)">{{ entry.done ? 'Undo' : 'Do' }}</button>
        </li>
    </ul>

</div>
```

### ვისწავლოთ მეტი Vue-ს შესახებ

Vue.js - მძლავრი ბიბლიოთეკაა, რომელიც საშუელებას იძლევა ადვილად შევქმნათ რეაქტიული ვებ-ინტერფეისები. მეტი ინფორმაციისათვის უნდა გავეცნოთ [ოფიციალურ სახლმძღვანელოს] (http://vuejs.org/guide/). ასევე სასარგებლო იქნება  [ვიდეო  Vue.js-ზე] (https://laracasts.com/series/learning-vue-step-by-step). ერთიც და მეორეც კარგი საშუალებაა წერილობით თუ ვიდეო ფორმატში, იმისა, გავარჩიოთ რა შეუძლია გააკეთოს Vue-ს.

<a id="complete"></a>
## დასრულებული მაგალითი

მოცემულ მაგალითში რეალიზებულია რევერის მხარის ნაწიის ფაქტიური შენახვა, ყველაფერი მოცემულია სუფთა პირველად კოდში. ის აერთიანებს ყველა წინა ნაბიჯს, სადაც ჩვენ აღვწერეთ, როგორ უნდა შევქმნათ მარტივი გაფართოება სახელად  Todo. ეს  ყველასთვის [ბელმისაწვდომია Github-ზე] (https://github.com/pagekit/example-todo).
